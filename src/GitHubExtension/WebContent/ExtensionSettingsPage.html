<!DOCTYPE html>
<html>
<head>
    <title>Extension Settings Page Demo</title>
    <script>
        "use strict";

        var lightMode = "rgb(243, 243, 243)";
        var darkMode = "rgb(32, 32, 32)";

        function doPostMessage(message) {
            // Do different things in WebView2 vs the browser, so neither gets an error
            try {
                window.chrome.webview.postMessage(message);
                console.log("window.chrome");

            }
            catch {
                window.postMessage(message);
            }
        };

        /*

        function queryTheme() {
            if (window.chrome && window.matchMedia) {
                console.log("window.chrome and matchMedia");
                // Check if the browser is in dark mode
                const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                console.log("darkModeMediaQuery: " + darkModeMediaQuery);
                return darkModeMediaQuery;
            }

            return null;
        }

        function updateTheme(themeEvent) {
            const theme = themeEvent.matches ? 'dark' : 'light';
            const bodyElement = document.getElementsByTagName("body")[0];
            const h1Element = document.getElementsByTagName("h1")[0];
            console.log("theme: " + theme);
            if (bodyElement && h1Element) {
                if (theme == 'dark') {
                    // change background color to match theme
                    bodyElement.style.backgroundColor = darkMode;
                    h1Element.style.color = lightMode;
                    console.log('Theme changed to dark mode.')
                } else if (theme == 'light') {
                    bodyElement.style.backgroundColor = lightMode;
                    h1Element.style.color = darkMode;
                    console.log('Theme changed to light mode.')
                } else {
                    console.error("Invalid theme detected: " + theme);
                }
            }
            else {
                console.error("Required elements not found in the DOM.");
            }
        }

        function checkForThemeChange() {
            const theme = queryTheme();
            updateTheme(theme);
        }

        // Define the method you want to run on page load
        function onPageLoad() {
            console.log('Page has fully loaded');
            // Your code to manipulate the DOM or perform other actions goes here
            const bodyElement = document.getElementsByTagName("body")[0];
            const h1Element = document.getElementsByTagName("h1")[0];
            if (bodyElement && h1Element) {
                console.log("Found body and h1 elements");
                // Perform any DOM manipulations or initializations here
                checkForThemeChange();
                console.log("checked for theme change");
            } else {
                console.error("Required elements not found in the DOM.");
            }
        }

        // Add an event listener for the DOMContentLoaded event
        document.addEventListener('DOMContentLoaded', (event) => {
            onPageLoad();
        });

        */

        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.setAttribute('data-theme', 'dark');
        } else {
            document.documentElement.setAttribute('data-theme', 'light');
        }

        function onGotFocus(x) {
            var output = (x.id) ? x.id : x;
            doPostMessage("Focus on: " + output);
            console.log("Focus on: " + output);
        };

        function onFocusOut() {
            if (!document.hasFocus()) {
                doPostMessage("Focus on: document lost focus");
                console.log("Focus on: document lost focus");
            }
        };

        function navigateToPage(webPage) {
            window.location.assign(webPage);
        }

    </script>
    <meta name="color-scheme" content="dark light">
    <style>
        /* Default styles (light mode) */
        body {
            background-color: rgb(243, 243, 243);
            color: rgb(32, 32, 32);
        }

        /* Dark mode styles */
        [data-theme="dark"] body {
            background-color: rgb(32, 32, 32);
            color: rgb(243, 243, 243);
        }
    </style>
</head>
<body id="body">
    <h1> Extension Settings Main Page </h1>
    <img id="cat" src="cat.jpg" style="width:500px; height:500px" />
    <div>
        <input id="b1B" type="submit" name="button" onclick="navigateToPage('ExtensionSettingsPage2.html')" value="Check out a cute dog" />
        <input id="b1B" type="submit" name="button" onclick="navigateToPage('TestCss.html')" value="CSS styled page example" />
        <input id="b1B" type="submit" name="button" onclick="navigateToPage('TestJQuery.html')" value="jquery page example" />
    </div>
</body>
</html>